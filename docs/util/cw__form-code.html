<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Tue Jul 18 13:37:40 2017 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cw__form.pro (OMINAS Documentation)</title>

    
    <style type="text/css" media="all">
            /* setup page */
      body { font-family: Helvetica, sans-serif; font-size: 12pt; margin: 0; padding: 0; }
      div.content { padding: 1em; }
      p { line-height: 1.4; }
      td p { padding-bottom: 0.5em; }
      img { border: 0; }
      
      /* link styles */
      a { text-decoration: none; }
      a:link, a:visited { color: #0000FF; }
      a:hover, a:focus { background: yellow; border-bottom: 1emx dotted #303099; }
      
      /* dir-overview styles */
      dt.filename { margin-top: 0.5em; }
      dl.file_listing { margin-left: 1em; }
      
      /* titles */
      h1, h2, h3, h4 { font-weight:normal; color: #871E31; margin-top: 1.5em; }
      h4 { margin-bottom: 0.25em; }
      .center { margin-left: auto; margin-right: auto; }
      .small { font-family: Verdana, Helvetica, sans-serif; font-size: 90%; }
      .smaller { font-family: Verdana, Helvetica, sans-serif; font-size: 80%; }
      .smallest { font-family: Verdana, Helvetica, sans-serif; font-size: 70%; }
      h1.basename { margin-top: 0; margin-bottom: 0; }
      h1.basename span.file-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      h2.directory { font-size: 90%; margin-bottom: 0; }
      h2.routine-name { margin-top: 0; margin-bottom: 0; }
      p.categories { color: #384806; margin-top: 0; }
      span.file_attribute { float: right; color: #384806; margin: 0 0 1em 3em; }
      div#file_comments { margin-top: 1em; }
      
      div.routine-details { border: 1px dotted #C0C0C0; margin-top: 1em; padding: 1em; }
      span.routine-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      div.details dt { color: #871E31; margin-left: 2em; }
      div.details dt span { color: #384806; margin-left: 2em; }
      div.details dd { margin: 0.5em 2em 1em 4em; }
      a.top {
        font-family: Verdana, Helvetica, sans-serif;
        font-size: 8pt;
        font-weight: bold;
        color: #5070ff;
        text-transform: uppercase;
        float: right;
        margin-left: 1em;
      }
      
      /* comments */
      .pre { white-space: pre; }
      
      /* code styles */
      code { font-family: Monaco, "Courier New", Courier, monospace; font-size: 95%; }
      code.listing { white-space: pre; display: block; margin: 0.75em 0 0.75em 0; padding: 0 3em 0 1em; line-height: 1.4em; }
      code.source { white-space: pre; display: block; }
      code.source span.comments { color: #408080; }
      .syntax { margin-top: 1em; margin-left: 1.5em; text-indent: -1.5em; }
      .var { font-style: italic; }
      .argument { } /* white-space: nowrap; does not work in Safari (and sometimes not even in Firefox) */
      
      dl.routine-summary dt { margin-bottom: 0.25em; }
      dl.routine-summary dd { margin-bottom: 0.5em; margin-left: 2em; }
      
      ul.inherited-method-summary { padding-left: 0em; margin-left: 0em; }
      
      /* general styles */
      ul li { list-style-type: none; }
      table { empty-cells: show; }
      thead { color: #871E31; }
      dd { margin-bottom: 0.35em; }
      input, textarea { background: #F3F6ED; border: #E1D6C6 1px solid; padding: 2px 1em 2px 0.5em; }
      input.text { background: #FFFFC0; }
      
      div.note { margin: 1em 2em 1em 2em; background: #EFEFEF; border: 1px #A0A0A0 dotted; padding: 0 1em 0 1em; }
      p.indent { margin-left: 2em; }
      
      /* An attribute table is a vertical list of name-value pairs. */
      table.box {
        background: #EFEFEF;
        border: 1px #A0A0A0 dotted;
        padding-top: 0.75em;
        padding-bottom: 0.75em;
      }
      table.attribute { padding-left: 0.75em; padding-right: 0.75em; }
      table td { vertical-align: top; }
      table.attribute p { margin: 0; }
      table td.name { font-style: normal; padding-right: 1.5em; }
      ul.fieldslist { padding-top: 0; color: #909090; }
      ul.fieldslist li { margin-bottom: 0.25em; }
      span.fieldname { color: #000000; }
      
      dl.attribute dt { color: #990000; }
      
      /* header/navbar styles */
      div.header { padding: 2em 2em 0 2em; background: #9E9D7B; border-bottom: 2px #262626 solid; }
      div.header h1 { color: white; margin:0; font-weight: normal; }
      div.header h2 { color: white; margin-top: 0; margin-bottom: 1em; font-weight: normal; font-style: italic; font-size: 100%; }
      table.navbar { background: #CCC097; margin: 0; padding: 0; border-bottom: 1px #262626 dotted; width: 100%; }
      table.navbar td { padding: 4px 0.5em 3px 0.5em; white-space: nowrap; vertical-align: top; }
      table.navbar td.flexible { width: 100%; text-align: right; padding-right: 1em; white-space: nowrap; }
      table.navbar td.selected { background: #262626; }
      table.navbar td.selected, table.navbar td.selected a { color: white; }
      table.navbar a:hover, table.navbar a:focus { background: inherit; border-bottom: 1px solid #303099; }
      p.localnavbar { text-align: right; margin: 0.2em 1em 0.2em 0.2em; padding: 0; }
      
      /* CSS graphics styles */
      div.box {
        margin-left: 0.25em;
        display: inline-block;
        width: 0.9em;
        height: 0.9em;
        vertical-align: -1px;
      }
      .red { background-color: #A00; }
      .orange { background-color: #F40; }
      .green { background-color: #480; }
      
      /* index styles */
      span.index_type { margin-left: 1em; }
      dl.index_listing dd { margin-bottom: 0.5em; margin-left: 2em; }
      dl.index_listing dd p { margin-top: 0.2em; margin-bottom: 0em; }
      
      /* search styles */
      fieldset { border: #ddd 1px solid; padding: 1em; margin-top: 3em; }
      legend { color: #871E31; font-size: 120%; }
      label { white-space: nowrap; }
      p.description { margin: 2em 2em 1em 2em; }
      form table td.name { vertical-align: middle; }
      
      /* footer styles */
      div.footer { padding: 0.5em 1em 0.5em 1em; background: #EFEFEF; border-top: 1px #A0A0A0 dotted; }
      div.footer table { width: 100%; }
      div.footer td.right { text-align: right; }

    </style>
    <style type="text/css" media="print">
            p.localnavbar { display: none; }
      
      div.header { background: white; }
      div.header h1 { color: black; }
      div.header h2 { color: black; }

    </style>
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cw__form.pro (OMINAS Documentation)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; $Id: cw__form.pro,v 1.25 1999/10/15 01:30:24 ali Exp $</span>
<span class="comments">;</span>
<span class="comments">; Copyright (c) 1995-1999, Research Systems, Inc.  All rights reserved.</span>
<span class="comments">;	Unauthorized reproduction prohibited.</span>
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	CW__FORM</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	CW__FORM is a compound widget that simplifies creating</span>
<span class="comments">;	small forms which contain text, numeric fields, buttons, </span>
<span class="comments">;	lists and droplists.  Event handling is also simplified.</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;	Compound widgets.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	widget = CW__FORM([Parent,] Desc)</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       Parent:	The ID of the parent widget.  Omitted for a top level </span>
<span class="comments">;		modal widget.</span>

<span class="comments">; Desc: A string array describing the form.  Each element of the</span>
<span class="comments">;	string array contains two or more comma-delimited fields.  The</span>
<span class="comments">;	character '\' may be used to escape commas that appear within fields.</span>
<span class="comments">;	To include the backslash character, escape it with a second</span>
<span class="comments">;	backslash.  Field names are case insensitive.</span>
<span class="comments">;</span>
<span class="comments">;	The fields are defined as follows:</span>
<span class="comments">;</span>
<span class="comments">; Field 1: Depth: the digit 0, 1, 2, or 3.  0 continues the current</span>
<span class="comments">;	level, 1 begins a new level, 2 denotes the last element of the</span>
<span class="comments">;	current level, and 3 both begins a new level and is the last entry of</span>
<span class="comments">;	the current level.  Nesting is used primarily with row or column </span>
<span class="comments">;	bases for layout.  See the example below.</span>
<span class="comments">; Field 2: Item type: BASE, BUTTON, DROPLIST, FLOAT, INTEGER, LABEL, LIST,</span>
<span class="comments">;		or TEXT.</span>
<span class="comments">;	The items return the following value types:</span>
<span class="comments">;	BUTTON - For single buttons, 0 if clear, 1 if set.</span>
<span class="comments">;		For multiple buttons, also called button groups, that are</span>
<span class="comments">;		exclusive, the index of the currently set button is returned.</span>
<span class="comments">;		For non-exclusive button groups, the value is an array</span>
<span class="comments">;		with an element for each button, containing 1</span>
<span class="comments">;		if the button is set, 0 otherwise.</span>
<span class="comments">;	DROPLIST, LIST - a 0 based index indicating which item is selected.</span>
<span class="comments">;	FLOAT, INTEGER, TEXT - return their respective data type.</span>
<span class="comments">;</span>
<span class="comments">; Field 3: Initial value.  Omitted for bases.</span>
<span class="comments">;	For BUTTON and DROPLIST items, the value field contains one</span>
<span class="comments">;		or more item names, delimited by the | character.</span>
<span class="comments">;	For FLOAT, INTEGER, LABEL, and TEXT items the value field contains the</span>
<span class="comments">;		initial value of the field.</span>
<span class="comments">;</span>
<span class="comments">; Fields 4 and following: Keywords or Keyword=value pairs that specify</span>
<span class="comments">;	optional attributes or options.  Keywords are case insensitive</span>
<span class="comments">;	and an optional leading '/' character is discarded.</span>
<span class="comments">;	Possibilities include:</span>
<span class="comments">;</span>
<span class="comments">;	COLUMN	If present, specifies column layout for bases or multiple</span>
<span class="comments">;		buttons.</span>
<span class="comments">;	EXCLUSIVE  If present makes an exclusive set of buttons.  The</span>
<span class="comments">;		default is nonexclusive.</span>
<span class="comments">;	EVENT=&lt;name> specifies the name of a user-written event function that</span>
<span class="comments">;		is called whenever the element is changed.  The function</span>
<span class="comments">;		is called with one parameter, the event structure.  It may</span>
<span class="comments">;		return an event structure or zero to indicate that no</span>
<span class="comments">;		further event processing is desired.</span>
<span class="comments">;	FONT=&lt;font name>  If present, the font for the item is specified.</span>
<span class="comments">;	FRAME:	If present, a frame is drawn around the item.  May be used</span>
<span class="comments">;		with all items.</span>
<span class="comments">;	LABEL_LEFT=&lt;label>  annotate a button or button group with a label</span>
<span class="comments">;		placed to the left of the buttons.  Valid with BUTTON,</span>
<span class="comments">;		DROPLIST, FLOAT, INTEGER, LIST and TEXT items.</span>
<span class="comments">;	LABEL_TOP=&lt;label> annotate a button or button group with a label</span>
<span class="comments">;		placed at the top of the buttons.  Valid with BUTTON,</span>
<span class="comments">;		DROPLIST, FLOAT, INTEGER, LIST and TEXT items.</span>
<span class="comments">;	LEFT, CENTER, or RIGHT   Specifies alignment of label items.</span>
<span class="comments">;	QUIT	If present, when the user activiates this entry when it</span>
<span class="comments">;		is activated as a modal widget, the form is destroyed</span>
<span class="comments">;		and its value returned as the result of CW__FORM.  For non-</span>
<span class="comments">;		modal form widgets, events generated by changing this item</span>
<span class="comments">;		have their QUIT field set to 1.</span>
<span class="comments">;	ROW	If present, specifies row layout for bases or multiple</span>
<span class="comments">;		buttons.</span>
<span class="comments">;	SCROLL:	If present, the base will have a scrollbar.</span>
<span class="comments">;	SET_VALUE  Sets the initial value of button groups or droplists.</span>
<span class="comments">;	TAG=&lt;name>   the tag name  of this element.  The widget's value</span>
<span class="comments">;		is a structure corresponding to the form.  Each form item</span>
<span class="comments">;		has a corresponding tag-value pair in the widget's value.</span>
<span class="comments">;		Default = TAGnnn, where nnn is the index of the item</span>
<span class="comments">;		in the Desc array.</span>
<span class="comments">;	WIDTH=n Specifies the width, in characters, of a TEXT, INTEGER,</span>
<span class="comments">;		or FLOAT item.</span>
<span class="comments">;	ALL_EVENTS Determines whether all events or just end-of-line events </span>
<span class="comments">;	           are generated for TEXT, INTEGER, or FLOAT items.</span>
<span class="comments">;	</span>
<span class="comments">; KEYWORD PARAMETERS:</span>
<span class="comments">;	COLUMN:		  If set the main orientation is vertical, otherwise</span>
<span class="comments">;			  horizontal.</span>
<span class="comments">;	IDS:		  A named variable into which the widget id of</span>
<span class="comments">;				each widget corresponding to an element</span>
<span class="comments">;				in desc is stored.</span>
<span class="comments">;	tags:		  A named variable into which the structure tag of</span>
<span class="comments">;				each widget corresponding to an element</span>
<span class="comments">;				in desc is stored.  </span>
<span class="comments">;	TITLE:		  The title of the top level base.  Not used</span>
<span class="comments">;			  if a parent widget is supplied.</span>
<span class="comments">;	UVALUE:		  The user value to be associated with the widget.</span>
<span class="comments">;       UNAME:            The user name to be associated with the widget.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       If Parent is supplied, the result is the ID of the base containing</span>
<span class="comments">;	the form.  If Parent is omitted, the form is realized as a modal</span>
<span class="comments">;	top level widget. The function result is then a structure containing</span>
<span class="comments">;	the value of each field in the form when the user finishes.</span>
<span class="comments">;</span>
<span class="comments">;	This widget has a value that is a structure with a tag/value pair</span>
<span class="comments">;	for each field in the form.  WIDGET_CONTROL, id, GET_VALUE=v may</span>
<span class="comments">;	be used to read the current value of the form.  WIDGET_CONTROL, id,</span>
<span class="comments">;	SET_VALUE={ Tagname: value, ..., Tagname: value} sets the values</span>
<span class="comments">;	of one or more tags.</span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;	Widgets are created.</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;	</span>
<span class="comments">; EXAMPLES:</span>

<span class="comments">;	**** Define a form, with a label, followed by two vertical button</span>
<span class="comments">;	groups one non-exclusive and the other exclusive, followed by a text</span>
<span class="comments">;	field, and an integer field, followed lastly by OK and Done buttons.</span>
<span class="comments">;	If either the OK or Done buttons are pressed, the form is exited.</span>
<span class="comments">;	</span>
<span class="comments">;</span>
<span class="comments">;		; String array describing the form</span>
<span class="comments">;	desc = [ $</span>
<span class="comments">;	    '0, LABEL, Centered Label, CENTER', $</span>
<span class="comments">;		; Define a row base on a new depth.  All elements until a depth</span>
<span class="comments">;		; of two are included in the row.</span>
<span class="comments">; 	    '1, BASE,, ROW, FRAME', $</span>
<span class="comments">; 	    '0, BUTTON, B1|B2|B3, LABEL_TOP=Nonexclusive:, COLUMN, ' + $</span>
<span class="comments">;               'TAG=bg1, ' + $</span>
<span class="comments">;               'SET_VALUE=[1\, 0\, 1]', $   ; set first and third buttons</span>
<span class="comments">;		; This element terminates the row.</span>
<span class="comments">; 	    '2, BUTTON, E1|E2|E2, EXCLUSIVE,LABEL_TOP=Exclusive,COLUMN, ' + $</span>
<span class="comments">;               'TAG=bg2, ' + $</span>
<span class="comments">;               'SET_VALUE=1', $   ; set second button</span>
<span class="comments">; 	    '0, TEXT, , LABEL_LEFT=Enter File name:, WIDTH=12, TAG=fname', $</span>
<span class="comments">;	    '0, INTEGER, 0, LABEL_LEFT=File size:, WIDTH=6, TAG=fsize', $</span>
<span class="comments">;	    '1, BASE,, ROW', $</span>
<span class="comments">;	    '0, BUTTON, OK, QUIT,FONT=*helvetica-medium-r-*-180-*,TAG=OK', $</span>
<span class="comments">;	    '2, BUTTON, Cancel, QUIT']</span>
<span class="comments">;</span>
<span class="comments">;    To use the form in a modal manner:</span>
<span class="comments">;	  a = CW__FORM(desc, /COLUMN)</span>
<span class="comments">;	  help, /st,a</span>
<span class="comments">;    When the form is exited, (when the user presses the OK or Cancel buttons), </span>
<span class="comments">;	the following structure is returned as the function's value:</span>
<span class="comments">;		BG1             INT       Array(3)  (Set buttons = 1, else 0)</span>
<span class="comments">;		BG2             INT              1  (Exclusive: a single index)</span>
<span class="comments">;		FNAME           STRING    'test.dat' (text field)</span>
<span class="comments">;		FSIZE           LONG               120 (integer field)</span>
<span class="comments">;		OK              LONG                 1 (this button was pressed)</span>
<span class="comments">;		TAG8            LONG                 0 (this button wasn't)</span>
<span class="comments">;	Note that if the Cancel button is pressed, the widget is exited with</span>
<span class="comments">;	the OK field set to 0.</span>
<span class="comments">;</span>
<span class="comments">;  *****************</span>
<span class="comments">;</span>
<span class="comments">;    To use CW__FORM inside another widget:</span>
<span class="comments">;	    a = widget_base(title='Testing')</span>
<span class="comments">;	    b = cw__form(a, desc, /COLUMN)</span>
<span class="comments">;	    WIDGET_CONTROL, a, /real</span>
<span class="comments">;	    xmanager, 'Test', a</span>
<span class="comments">;	In this example, an event is generated each time the value of</span>
<span class="comments">;	the form is changed.  The event has the following structure:</span>
<span class="comments">;	   ID              LONG                &lt;id of CW__FORM widget></span>
<span class="comments">;	   TOP             LONG                &lt;id of top-level widget></span>
<span class="comments">;	   HANDLER         LONG                &lt;internal use></span>
<span class="comments">;	   TAG             STRING    'xxx'	; name of field that changed</span>
<span class="comments">;	   VALUE           INT       xxx	; new value of changed field</span>
<span class="comments">;	   QUIT            INT              0	; quit flag</span>
<span class="comments">;    The event handling procedure (in this example, called TEST_EVENT), may use</span>
<span class="comments">;	the TAG field of the event structure to determine which field</span>
<span class="comments">;	changed and perform any data validation or special actions required.</span>
<span class="comments">;	It can also get and set the value of the widget by calling</span>
<span class="comments">;	WIDGET_CONTROL.</span>
<span class="comments">;    A simple event procedure might be written to monitor the QUIT field</span>
<span class="comments">;	of events from the forms widget, and if set, read and save the</span>
<span class="comments">;	widget's value, and finally destroy the widget.</span>
<span class="comments">;</span>
<span class="comments">;    To set or change a field within the form from a program, use a the</span>
<span class="comments">;	WIDGET_CONTROL procedure:</span>
<span class="comments">;	   	WIDGET_CONTROL, b, SET_VALUE={FNAME: 'junk.dat'}</span>
<span class="comments">;	This statement sets the file name field of this example.</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;	January, 1995.  DMS, Written.</span>
<span class="comments">;       June, 1996.     MLR, allowed SET_VALUE to be specified in the</span>
<span class="comments">;                       description string for DROPLIST widgets.</span>
<span class="comments">;	July, 2002.	Spitale, copied from cw_form.</span>
<span class="comments">;	July, 2002.	Spitale, added 'tags' keyword.</span>
<span class="comments">;	July, 2002.	Spitale, added 'all_events' keyword.</span>
<span class="comments">;	July, 2002.	Spitale, noted lameness of 'goto' statement in</span>
<span class="comments">;			cw__form_build</span>
<span class="comments">;	Dec., 2002.	Spitale, added 'TAG' keyword functionality for bases </span>
<span class="comments">;			and labels.</span>
<span class="comments">;	Dec., 2002.	Spitale, added 'SCROLL' keyword for bases.</span>
<span class="comments">;</span>
<span class="comments">; NOTICES:</span>
<span class="comments">;	Portions ©2017 Exelis Visual Information Solutions, Inc., provided </span>
<span class="comments">;	under license to the Jet Propulsion Laboratory. THE EXELIS VISUAL  </span>
<span class="comments">;	INFORMATION SOLUTIONS, INC. CODE IS PROVIDED "AS IS" AND ANY EXPRESS  </span>
<span class="comments">;	OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED  </span>
<span class="comments">;	WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  </span>
<span class="comments">;	ARE DISCLAIMED. IN NO EVENT SHALL EXELIS VISUAL INFORMATION SOLUTIONS,  </span>
<span class="comments">;	INC., ITS AFFILIATES, OFFICERS, DIRECTORS, EMPLOYEES, AGENTS, SUPPLIERS  </span>
<span class="comments">;	OR LICENSORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,  </span>
<span class="comments">;	EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,  </span>
<span class="comments">;	PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR  </span>
<span class="comments">;	PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY  </span>
<span class="comments">;	OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING  </span>
<span class="comments">;	NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS  </span>
<span class="comments">;	SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="comments">;-</span>
<span class="comments">;</span>


<span class="comments">;===========================================================================</span>
<span class="comments">; CW__FORM_PARSE</span>
<span class="comments">;</span>
<span class="comments">;===========================================================================</span>
<a id="CW__FORM_PARSE:source"></a>function CW__FORM_PARSE, Extra, Name, Value, Index=Index
<span class="comments">; Given the extra fields in the string array Extra,</span>
<span class="comments">;	determine if one field starts with Name.</span>
<span class="comments">; If so, return TRUE, otherwise FALSE.</span>
<span class="comments">; If the field contains the character '=' after Name, return the contents</span>
<span class="comments">; of the field following the equal sign in Value.</span>
<span class="comments">; Return the index of the found element in Index.</span>
<span class="comments">;</span>

  COMPILE_OPT hidden

found = where(strpos(extra, name) eq 0, count)
if count eq 0 then return, 0
if count gt 1 then message,'Ambiguous field name: '+name, /CONTINUE

index = found[0]
item = extra[index]
nlen = strlen(name)
value = ''			<span class="comments">;Assume no value</span>
equal = strpos(item,'=',nlen) <span class="comments">;Find = character</span>
if equal ge 0 then begin
   value = strmid(item, equal+1, 1000) <span class="comments">;Extract following</span>
   <span class="comments">; Tag must not start with space; Other fields such as</span>
   <span class="comments">; Label may have leading or trailing spaces so only trim Tag.</span>
   if (strupcase(name) eq 'TAG') then value=strtrim(value, 2)
endif
extra[index]=''			<span class="comments">;clean it out...</span>
return, 1
end
<span class="comments">;===========================================================================</span>



<span class="comments">;===========================================================================</span>
<span class="comments">; CW__FORM_APPEND</span>
<span class="comments">;</span>
<span class="comments">;===========================================================================</span>
<a id="CW__FORM_APPEND:source"></a>pro CW__FORM_APPEND, extra, e, keyword, USE_VALUE=use_value, ACTUAL_KEYWORD=akw
  COMPILE_OPT hidden

if CW__FORM_PARSE(e, keyword, value) then begin
    if n_elements(akw) le 0 then akw = keyword
    if KEYWORD_SET(use_value) eq 0 then value = 1
    if n_elements(extra) eq 0 then extra = create_struct(akw, value) $
    else extra = create_struct(extra, akw, value)
endif
end
<span class="comments">;===========================================================================</span>



<span class="comments">;===========================================================================</span>
<span class="comments">; CW__FORM_LABEL</span>
<span class="comments">;</span>
<span class="comments">;===========================================================================</span>
<a id="CW__FORM_LABEL:source"></a>pro CW__FORM_LABEL, parent, nparent, e, frame
<span class="comments">;Put LABEL_LEFT and/or LABEL_RIGHT on a base.</span>

  COMPILE_OPT hidden

nparent = parent
if CW__FORM_PARSE(e, 'LABEL_LEFT', value) then begin
	nparent = WIDGET_BASE(nparent, /ROW, FRAME=frame)
	frame = 0
	junk1 = WIDGET_LABEL(nparent, VALUE=value)
	endif
if CW__FORM_PARSE(e, 'LABEL_TOP', value) then begin
	nparent = WIDGET_BASE(nparent, /COLUMN, FRAME=frame)
	frame = 0
	junk1 = WIDGET_LABEL(nparent, VALUE=value)
	endif
end
<span class="comments">;===========================================================================</span>



<span class="comments">;===========================================================================</span>
<span class="comments">; CW__FORM_BUILD</span>
<span class="comments">;</span>
<span class="comments">;===========================================================================</span>
<span class="comments">;pro CW__FORM_BUILD, parent, desc, cur, ids, lasttag</span>
<a id="CW__FORM_BUILD:source"></a>pro CW__FORM_BUILD, parent, desc, cur, ids, tags, lasttag   <span class="comments">; Spitale, 7/2002</span>
<span class="comments">; Recursive routine that builds the form hierarchy described in DESC.</span>
<span class="comments">; Returns the ID of each button in ids.</span>

  COMPILE_OPT hidden

<span class="comments">; Format of a field descriptor:</span>
<span class="comments">; Field 0,  Flags: </span>
<span class="comments">; Field 1, Type of item.  BASE, LABEL, INTEGER, FLOAT, DROPLIST,</span>
<span class="comments">;	EXCLUSIVE_BUTTONS, TEXT</span>
<span class="comments">; Field 2, Value of item...</span>
<span class="comments">; Fields >= 3, optional flags</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; Type id = 0 for bgroup, 1 for droplist, 2 for button,</span>
<span class="comments">;	3 for integer, 4 for float, 5 for text, 6 for list.</span>
<span class="comments">;</span>
  n = n_elements(desc)

  while cur lt n do begin
    a = STRTRIM(strtok(desc[cur], ',', $
           /PRESERVE_NULL, /EXTRACT, ESC='\'), 2)
    if n_elements(a) lt 2 then $
	message,'Form element '+strtrim(cur,2)+'is missing a field separator'
    extra=0			<span class="comments">;Clear extra keywords by making it undefined</span>
    junk = temporary(extra)	<span class="comments">;Clear common param list</span>
    type = -1			<span class="comments">;Assume type == no events.</span>
    quit = 0
    frame = 0
    if n_elements(a) gt 3 then begin	<span class="comments">;Addt'l common params?</span>
	e = a[3:*]		<span class="comments">;Remove leading/trailing blanks</span>
	for i=0, n_elements(e)-1 do begin  <span class="comments">;Up case it</span>
	    s = e[i]
	    if strmid(s,0,1) eq '/' then s = strmid(s,1,1000)  <span class="comments">;Disc. leading /</span>
	    equal = strpos(s, '=')
	    if equal gt 0 then $
		e[i] = strupcase(strmid(s,0,equal)) + strmid(s,equal, 1000) $
	    else e[i] = strupcase(s)
	    endfor 
	quit = CW__FORM_PARSE(e, 'QUIT')
	frame = CW__FORM_PARSE(e, 'FRAME')
        title = ''
	temp = CW__FORM_PARSE(e, 'TITLE', title)		<span class="comments">; Spitale 10/2012</span>
	scroll = CW__FORM_PARSE(e, 'SCROLL')		<span class="comments">; Spitale 12/2002</span>
	efn = CW__FORM_PARSE(e, 'EVENT', event_fun)
	CW__FORM_APPEND, extra, e, 'FONT', /USE_VALUE
	CW__FORM_APPEND, extra, e, 'COLUMN'
	CW__FORM_APPEND, extra, e, 'ROW'
	CW__FORM_APPEND, extra, e, 'LEFT', ACTUAL='ALIGN_LEFT'
	CW__FORM_APPEND, extra, e, 'CENTER', ACTUAL='ALIGN_CENTER'
	CW__FORM_APPEND, extra, e, 'RIGHT', ACTUAL='ALIGN_RIGHT'

	ww = where(strtrim(e,2) NE '')			<span class="comments">; Spitale 12/2002</span>
	if(ww[0] EQ -1) then e = '' $			<span class="comments">; Spitale 12/2002</span>
	else e = e[ww]					<span class="comments">; Spitale 12/2002</span>
    endif else e = ''

    case STRUPCASE(a[1]) of		<span class="comments">;Which widget type?</span>
'TAB': BEGIN
    new = WIDGET_TAB(parent)
    if(keyword__set(e)) then type = 12			<span class="comments">; Spitale 10/2012</span>
    value = 0L						<span class="comments">; Spitale 10/2012</span>
    uextra = { VALUE: value }    			<span class="comments">; Spitale 10/2012</span>
    ENDCASE
'BASE': BEGIN
    new = WIDGET_BASE(parent, FRAME=frame, _EXTRA=extra, scroll=scroll, title=title)
    if(keyword__set(e)) then type = 11			<span class="comments">; Spitale 12/2002</span>
    value = 0L						<span class="comments">; Spitale 12/2002</span>
    uextra = { VALUE: value }    			<span class="comments">; Spitale 12/2002</span>
    ENDCASE
'BUTTON': BEGIN
    CW__FORM_APPEND, extra, e, 'LABEL_LEFT', /USE_VALUE
    CW__FORM_APPEND, extra, e, 'LABEL_TOP', /USE_VALUE
    exclusive = CW__FORM_PARSE(e,'EXCLUSIVE')
    no_release = CW__FORM_PARSE(e,'NO_RELEASE')
    values = strtok(a[2],'|', /EXTRACT, ESC='\')
    if n_elements(values) ge 2 then begin
        type = 0
        if CW__FORM_PARSE(e, 'SET_VALUE', temp) then begin

<span class="comments">;;           result = execute('sval=fix('+temp+')')</span>
            if (!version.release ge '8.4') then begin
             lf=lambda('x:'+temp)
             sval=fix(call_function(lf,0))
            endif else result = execute('sval=fix('+temp+')')


          new = cw_bgroup(parent, strtok(a[2],'|',/EXTRACT),  $
		        EXCLUSIVE = exclusive, NONEXCLUSIVE = 1-exclusive, $
		        FRAME=frame, NO_RELEASE = no_release, $
                        SET_VALUE = sval, _EXTRA=extra)
        endif else begin
           new = cw_bgroup(parent, strtok(a[2],'|',/EXTRACT),  $
		        EXCLUSIVE = exclusive, NONEXCLUSIVE = 1-exclusive, $
		        FRAME=frame, NO_RELEASE = no_release, _EXTRA=extra)
        endelse
        WIDGET_CONTROL, new, GET_VALUE=value
    endif else begin
        type = 2
	new = WIDGET_BUTTON(parent, value=values[0], FRAME=frame, _EXTRA=extra)
	value = 0L
    endelse
    uextra = { value: value }
    ENDCASE
'DROPLIST': BEGIN
    CW__FORM_LABEL, parent, nparent, e, frame
    new = WIDGET_DROPLIST(nparent, VALUE = strtok(a[2], '|',/EXTRACT), $
		FRAME=frame, UVALUE=ids[n], _EXTRA=extra)
    if CW__FORM_PARSE(e, 'SET_VALUE', value) then $
          WIDGET_CONTROL, new, SET_DROPLIST_SELECT = value
    uextra = { VALUE: FIX(value) }
    type = 1
    ENDCASE
'INTEGER': BEGIN
    type = 3
    value = 0L
process_integer:
    uextra = { VALUE: value }    
    CW__FORM_LABEL, parent, nparent, e, frame
    if CW__FORM_PARSE(e, 'WIDTH', temp) then width = fix(temp) else width=6
    all_events = cw__form_parse(e, 'ALL_EVENTS', temp)	<span class="comments">; Spitale, 7/2002</span>
<span class="comments">;    new = WIDGET_TEXT(nparent, /ALL_EVENTS, /EDITABLE, YSIZE=1, $</span>
<span class="comments">;		XSIZE=width, UVALUE=ids[n])</span>
    new = WIDGET_TEXT(nparent, all_events=all_events, /EDITABLE, YSIZE=1, $
		XSIZE=width, UVALUE=ids[n])		 <span class="comments">; Spitale, 7/2002</span>
    if n_elements(a) ge 3 then BEGIN		<span class="comments">;Save value</span>
	WIDGET_CONTROL, new, SET_VALUE=a[2]
	uextra.value = a[2]
	endif
   ENDCASE
'FLOAT': BEGIN
    type = 4
    value = 0.0
    goto, process_integer
    ENDCASE
'LABEL': BEGIN
    new = WIDGET_LABEL(parent, value=a[2], FRAME=frame, _EXTRA=extra)
    if(keyword__set(e)) then type = 12			<span class="comments">; Spitale 12/2002</span>
    value = 0L						<span class="comments">; Spitale 12/2002</span>
    uextra = { VALUE: value }    			<span class="comments">; Spitale 12/2002</span>
    ENDCASE
'LIST': BEGIN
    CW__FORM_LABEL, parent, nparent, e, frame
    v = strtok(a[2], '|',/EXTRACT)
    if CW__FORM_PARSE(e, 'HEIGHT', temp) eq 0 then temp = n_elements(v)
    new = WIDGET_LIST(nparent, VALUE = v, YSIZE=temp, $
		FRAME=frame, UVALUE=ids[n], _EXTRA=extra)
    if CW__FORM_PARSE(e, 'SET_VALUE', value) then $
          WIDGET_CONTROL, new, SET_LIST_SELECT = FIX(value)
    uextra = { VALUE: FIX(value) }
    v = 0
    type = 6
    ENDCASE
'TEXT': BEGIN
    type=5
    value = ''
    goto, process_integer	<span class="comments">; comment by Spitale -- this is freakin' lame </span>
    ENDCASE
else: BEGIN
	MESSAGE,'Illegal form element type: ' + a[1], /CONTINUE
	new = WIDGET_BASE(parent)
    ENDCASE
ENDCASE

    ids[cur] = new
    if type ge 0 then begin
	if CW__FORM_PARSE(e, 'TAG', value) then value = STRUPCASE(value) $
	else value='TAG'+strtrim(cur,2)	  <span class="comments">;default name = TAGnnn.</span>
	tags[cur] = value	<span class="comments">; Spitale 7/2002</span>
        u = CREATE_STRUCT( $
		{ type: type, base: ids[n+1], tag:value, next: 0L, quit:quit}, $
		uextra)
	widget_control, new, SET_UVALUE= u
		<span class="comments">;First tag?  If so, set child uvalue -> important widget ids.</span>
	if lasttag eq 0 then begin
	    WIDGET_CONTROL, ids[n], GET_UVALUE=tmp, /NO_COPY
	    tmp.head = new
	    WIDGET_CONTROL, ids[n], SET_UVALUE=tmp, /NO_COPY
	endif else begin		<span class="comments">;Otherwise, update chain.</span>
	    WIDGET_CONTROL, lasttag, GET_UVALUE=u, /NO_COPY
	    u.next = new
	    WIDGET_CONTROL, lasttag, SET_UVALUE=u, /NO_COPY
	    endelse
	lasttag = new
	if (N_ELEMENTS(efn) NE 0) AND (N_ELEMENTS(event_fun) NE 0) then $
           WIDGET_CONTROL, new, EVENT_FUNC = event_fun
	endif			<span class="comments">;Type</span>

    i = where(strlen(e) gt 0, count)
    if count gt 0 then begin	<span class="comments">;Unrecognized fields?</span>
	Message, /CONTINUE, 'Descriptor: '+ desc[cur]
	for j=0, count-1 do message, /CONTINUE, 'Unrecognized field: '+ e[i[j]]
	endif

    cur = cur + 1
    dflags = fix(a[0])		<span class="comments">;Level flags</span>
<span class="comments">;    if dflags and 1 then CW__FORM_BUILD, new, desc, cur, ids, lasttag;Begin new</span>
    if dflags and 1 then $
       CW__FORM_BUILD, new, desc, cur, ids, tags, lasttag  <span class="comments">; Spitale 7/2002</span>
    if (dflags and 2) ne 0 then return	<span class="comments">;End current</span>
  endwhile
end				<span class="comments">;CW__FORM_BUILD</span>
<span class="comments">;===========================================================================</span>



<span class="comments">;===========================================================================</span>
<span class="comments">; CW__FORM_EVENT</span>
<span class="comments">;</span>
<span class="comments">;===========================================================================</span>
Function CW__FORM_EVENT, ev		<span class="comments">;Event handler for CW__FORM</span>
  COMPILE_OPT hidden
widget_control,   ev.id, GET_UVALUE=u, /NO_COPY  <span class="comments">;What kind of widget?</span>

if (u.type eq 1) or (u.type eq 6) then begin	<span class="comments">;Droplist?  (can't get value)</span>
    v = ev.index
    u.value = v
endif else if u.type eq 2 then begin
    v = ev.select
    u.value=v
endif else if u.type eq 12 then begin
    v = 0
    u.value=v
endif else begin		<span class="comments">;Other types of widgets</span>
    WIDGET_CONTROL, ev.id, GET_VALUE=v
    if u.type ge 3 then begin  <span class="comments">;Toss selection events from text widgets</span>
        v = v[0]
        ret = 0
        if ev.type eq 3 then goto, toss
        <span class="comments">; allow "+" or '-' to be entered without causing failure</span>
        <span class="comments">; of implicit conversion below</span>
        if (ev.type eq 0 or ev.type eq 2) and $
           (v eq '-' or v eq '+') then goto, toss
        <span class="comments">; allow "...e+" or '...e-' to be entered without causing failure</span>
        <span class="comments">; of implicit conversion below</span>
        if (strlen(v) gt 2) then begin
            tail = strupcase(strmid(v, strlen(v)-2))
            if (ev.type eq 0 or ev.type eq 2) and $
                (tail eq 'E-' or tail eq 'E+') then goto, toss
        endif
    endif
    on_ioerror, invalid
    u.value = v			<span class="comments">;Does an implicit conversion</span>
    v = u.value
    goto, back_in

<span class="comments">; We come here if we get an invalid number.  </span>
invalid: WIDGET_CONTROL, ev.id, SET_VALUE=''  <span class="comments">;Blank it out</span>
    v = ''
    u.value = ''
endelse			<span class="comments">;u.type</span>

back_in: ret= { id: u.base, top: ev.top, handler: 0L, $
		tag: u.tag, value: v, quit: u.quit} <span class="comments">;Our value</span>
toss: widget_control, ev.id, SET_UVALUE=u, /NO_COPY	<span class="comments">;Save new value...</span>
return, ret
end			<span class="comments">;CW__FORM_EVENT</span>
<span class="comments">;===========================================================================</span>



<span class="comments">;===========================================================================</span>
<span class="comments">; CW__FORM_SETV</span>
<span class="comments">;</span>
<span class="comments">;===========================================================================</span>
Pro CW__FORM_SETV, id, value	<span class="comments">;In this case, value = { Tagname : value, ... }</span>
  COMPILE_OPT hidden
x = WIDGET_INFO(id, /CHILD)	<span class="comments">;Get head of list</span>
WIDGET_CONTROL, x, GET_UVALUE=u
head = u.head
tags = tag_names(value)
n = n_elements(tags)

while head ne 0 do begin
    WIDGET_CONTROL, head, GET_UVALUE=u, /NO_COPY
    w = where(u.tag eq tags, count)
    if count ne 0 then begin
	u.value = value.(w[0])	<span class="comments">;Set the value</span>
	if u.type eq 6 then $
          WIDGET_CONTROL, head, SET_LIST_SELECT=value.(w[0]) $
        else if u.type eq 1 then $
          WIDGET_CONTROL, head, SET_DROPLIST_SELECT = value.(w[0]) $
	else if u.type ne 2 then $
          WIDGET_CONTROL, head, SET_VALUE= $
            STRCOMPRESS(STRING(value.(w[0])), /REMOVE_ALL) <span class="comments">;Change the widget</span>
	n = n - 1
	endif
    next = u.next
    WIDGET_CONTROL, head, SET_UVALUE=u, /NO_COPY
    if n le 0 then return		<span class="comments">;Done...</span>
    head = next
endwhile
end
<span class="comments">;===========================================================================</span>



<span class="comments">;===========================================================================</span>
<span class="comments">; CW__FORM_GETV</span>
<span class="comments">;</span>
<span class="comments">;===========================================================================</span>
Function CW__FORM_GETV, id	<span class="comments">;Return value of a CW__FORM widget.</span>
  COMPILE_OPT hidden

x = WIDGET_INFO(id, /CHILD)	<span class="comments">;Get head of list</span>
WIDGET_CONTROL, x, GET_UVALUE=u
head = u.head

while head ne 0 do begin
    WIDGET_CONTROL, head, GET_UVALUE=u, /NO_COPY
    if n_elements(ret) le 0 then ret = CREATE_STRUCT(u.tag, u.value) $
    else ret = CREATE_STRUCT(ret, u.tag, u.value)
    next = u.next
    WIDGET_CONTROL, head, SET_UVALUE=u, /NO_COPY
    head = next
endwhile
return, ret
end
<span class="comments">;===========================================================================</span>



<span class="comments">;===========================================================================</span>
<span class="comments">; cw__form_modal_event</span>
<span class="comments">;</span>
<span class="comments">;===========================================================================</span>
<a id="cw__form_modal_event:source"></a>pro cw__form_modal_event, ev
  COMPILE_OPT hidden

IF (TAG_NAMES(ev,/STRUCTURE_NAME) EQ 'WIDGET_KILL_REQUEST') THEN begin
    ev = CREATE_STRUCT(ev,'quit',1)
    <span class="comments">; reset id from the modal parent to it's child to access data</span>
    base = WIDGET_INFO(ev.id, /CHILD)
    ev.id = base
endif

if ev.quit ne 0 then begin
    child = WIDGET_INFO(ev.id, /CHILD)
    WIDGET_CONTROL, child, GET_UVALUE=u  <span class="comments">;Get handle</span>
    WIDGET_CONTROL, ev.id, GET_VALUE=v  <span class="comments">;The widget's value</span>
    WIDGET_CONTROL, ev.top, /DESTROY
    *u.handle = v
endif

end
<span class="comments">;===========================================================================</span>



<span class="comments">;===========================================================================</span>
<span class="comments">; CW__FORM</span>
<span class="comments">;</span>
<span class="comments">;===========================================================================</span>
FUNCTION CW__FORM, parent, desc, $
	COLUMN = column, IDS=ids, TITLE=title, UVALUE=uvalue, $
        UNAME=uname, $
	tags=tags	<span class="comments">; Spitale, 7/2002</span>

<span class="comments">;  ON_ERROR, 2						;return to caller</span>
  <span class="comments">; Set default values for the keywords</span>
  If KEYWORD_SET(column) then row = 0 else begin row = 1 & column = 0 & end
  IF (NOT KEYWORD_SET(uname)) THEN UNAME='CW__FORM_UNAME'

  p = parent
  handle = 0L
  if n_params() eq 1 then begin
	desc = parent
	if n_elements(title) le 0 then title='FORM Widget'
        temp = WIDGET_BASE()
	p = WIDGET_BASE(TITLE=title, Column = column, row=row, $
                        /TLB_KILL_REQUEST, $
                        GROUP_LEADER=temp, /MODAL)
	handle = nv_ptr_new(/ALLOCATE_HEAP)
  endif
  Base = WIDGET_BASE(p, Column = column, row=Row)

  if n_elements(uvalue) gt 0 then WIDGET_CONTROL, base, SET_UVALUE=uvalue
  if n_elements(uname) gt 0 then WIDGET_CONTROL, base, SET_UNAME=uname

  n = n_elements(desc)
  ids = lonarr(n+2)		<span class="comments">;Element n is ^ to child, n+1 ^ to base</span>
  tags = strarr(n+2)		<span class="comments">; Spitale; 7/2002</span>
  child = WIDGET_BASE(base)	<span class="comments">;Widget to contain info...</span>
  ids[n] = child
  ids[n+1] = base
  lasttag = 0
  WIDGET_CONTROL, child, SET_UVALUE={ head: 0L, base: base, handle: handle}

<span class="comments">;  CW__FORM_BUILD, base, desc, 0, ids, lasttag</span>
  CW__FORM_BUILD, base, desc, 0, ids, tags, lasttag	<span class="comments">; Spitale 7/2002</span>
  widget_control, base, EVENT_FUNC='CW__FORM_EVENT', $
	FUNC_GET_VALUE='CW__FORM_GETV', PRO_SET_VALUE='CW__FORM_SETV'

  if n_params() eq 1 then begin		<span class="comments">;Modal?</span>
	WIDGET_CONTROL, p, /realize
	XMANAGER, 'CW__FORM', p, EVENT_HANDLER='CW__FORM_MODAL_EVENT'
        v = TEMPORARY(*handle)
	ptr_free, handle
        WIDGET_CONTROL, temp, /DESTROY
	return, v
	endif
  return, base
END
<span class="comments">;===========================================================================</span>
</code>
    </div>
  </body>
</html>